# nmk model grammar definition
type: object
additionalProperties: false
properties:

    # references
    refs:
        type: array
        items:
            oneOf:
                # A reference is either a relative path/direct URL/repo relative to a model file...
                - type: string
                # ... or a repository definition
                - type: object
                  additionalProperties:
                    oneOf:
                        # A repository reference is either simply a remote URL...
                        - type: string
                        # ... or an object containing the remote URL, + other details
                        - type: object
                          additionalProperties: false
                          required:
                            - remote
                          properties:
                            # Repository remote reference
                            remote:
                                type: string
                            # Repository local reference
                            local:
                                type: string

    # configuration
    config:
        type: object
        additionalProperties:
          oneOf:
            # Simple scalar/array/dict config items
            - type: string
            - type: boolean
            - type: integer
            - type: array
            - type: object
              additionalProperties: true

    # tasks
    tasks:
        type: object
        additionalProperties:
            type: object
            additionalProperties: false
            properties:
                # Task builder implementation class, if any
                builder:
                    type: string
                # Emoji (for prettier logs!)
                emoji:
                    type: string
                # One line description, for online help
                description:
                    type: string
                # Silent task: no logs by default
                silent:
                    type: boolean
                # Task inputs
                input:
                    $ref: "#/$defs/stringRefs"
                # Task outputs
                output:
                    $ref: "#/$defs/stringRefs"
                # Dependencies:
                # - children deps
                deps:
                    type: array
                    items:
                        type: string
                # - parent dep (append after the existing ones)
                appendToDeps:
                    type: string
                # - parent dep (prepend before the existing ones)
                prependToDeps:
                    type: string
                # Default task
                default:
                    type: boolean
                # Required configuration items
                requiredConfig:
                    type: object
                    additionalProperties:
                        # Simple type definition (no default value)
                        $ref: "#/$defs/typeString"

$defs:
    # Reference string(s), i.e. either:
    # - a string
    # - an array of strings
    stringRefs:
        oneOf:
            - type: string
            - type: array
              items:
                  type: string

    # Config type string
    typeString:
        type: string
        enum:
            - str
            - int
            - bool
            - list
            - dict
